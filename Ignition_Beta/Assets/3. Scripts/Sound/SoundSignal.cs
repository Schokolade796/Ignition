using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using static UnityEditor.Experimental.GraphView.GraphView;

public class SoundSignal : MonoBehaviour
{
    [SerializeField, Tooltip("인식시키고 싶은 오브젝트")]
    private AudioSource audioSource;
    [SerializeField, Tooltip("Pivot Transfoem")]
    private Transform followObject;
    [SerializeField, Tooltip("소리 크기 (적이 인식하는 우선순위)")]
    private int soundVolume;
    [SerializeField]
    private LayerMask layer;

    private Collider[] colliders;
    private float audioMaxDistance;

    private void Awake()
    {
    }
    void Start()
    {
        audioMaxDistance = audioSource.maxDistance;
        StartCoroutine(SoundSignalToTheEnemy());
    }

    IEnumerator SoundSignalToTheEnemy()
    {
        while (true)
        {
            yield return null;
            if (!audioSource.isPlaying) yield break;
            colliders = Physics.OverlapSphere(followObject.position, audioMaxDistance, layer);
            Debug.Log(1);
            if (colliders.Length > 0)
            {
                foreach (Collider col in colliders)
                {
                    if (col.TryGetComponent<EnemyMove>(out var h))
                    {
                        h.Change(soundVolume, followObject);
                    }
                }
            }
        }
    }

    //private void OnDrawGizmos() // 테스트 후 지워도 됨
    //{
    //    audioMaxDistance = audioSource.maxDistance;
    //    Gizmos.color = Color.red;
    //    Gizmos.DrawWireSphere(transform.position, audioMaxDistance);
    //}
}









//아 왜 T1짐?????????????????????????????????? 이걸 결승을 못가네;;
//아 왜 T1짐?????????????????????????????????? 이걸 결승을 못가네;;
//아 왜 T1짐?????????????????????????????????? 이걸 결승을 못가네;;
//아 왜 T1짐?????????????????????????????????? 이걸 결승을 못가네;;
//아 왜 T1짐?????????????????????????????????? 이걸 결승을 못가네;;
//아 왜 T1짐?????????????????????????????????? 이걸 결승을 못가네;;